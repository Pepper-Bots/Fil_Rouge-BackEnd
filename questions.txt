
faut il cr√©er un ValidationAdmin ? -> DTO ?

entit√©s StatutDocument + StatutDossier existent -> bien faites ? les 2 sont elles n√©cessaires ? le Statut du Doc si valid√© et si tous les Doc fournis viennent modifier auto le Statut du Dossier

il faut donc mapper foramtion dans Document et non Dossier ? mais un Document doit compl√©ter un Dossier

comment diff√©rencier la liste th√©orique des documents attendus et les documents r√©ellement fournis ?

# Ce code :
List<ListeDocumentsObligatoires> requiredDocs = listeDocumentsObligatoiresRepository.findByFormationId(formationId);
// Pour chaque type, cr√©er un Document dans le dossier du stagiaire
# est √† mettre dans Formation ou dans Dossier ?


 garder TypeDocument en enum ou cr√©er une classe ?
 avec ceci : Pour chaque TypeDocument dans la table de correspondance, cr√©er un Document (statut = "√† fournir") dans le dossier du stagiaire.

 est ce que je dois garder l'entit√© Inscription ?


 Formation -(1,n)- ListeDocumentsObligatoires -(n,1)- TypeDocument
           |
           v
       Inscription  ---(1,1)--- Dossier ---(1,n)-- Document
           |                                 |
      Stagiaire                      StatutDocument
                                       |
                                StatutDossier

---------------------------------------------------------------------------------

la logique m√©tier dans DossierService.java :

- Un Admin cr√©er un profil de Stagiaire + son 1er Dossier d'inscription dans l'application.
- Le stagiaire re√ßoit un mail avec un lien pour activer son compte. le stagiaire clique sur le lien et active son compte dans l'application. une fois activ√©, le stagiaire peut acc√©der √† son compte et visualiser son dossier.
- A partir du moment o√π le compte du stagiaire est activ√©, il peut lui meme se pr√©-inscrire √† une autre formation et creer un nouveau dossier d'inscription qu'il devra aussi compl√©ter.
- Le dossier ou les dossiers du stagiaire doivent √™tre compl√©t√©s par un ensemble de documents qui doivent etre v√©rifi√©s et valid√©s pour que le dossier soit complet + accept√©
- un dossier = une inscription = une formation

----------------------------------------------------------------------

# Flux visuel

Admin/Stagiaire ‚Üí Cr√©e une inscription (formation X)
         |
         ‚Üí G√©n√®re un Dossier
         |
         ‚Üí G√©n√®re automatiquement tous les Documents obligatoires pour la formation
         |
         ‚Üí Documents √† fournir (statut initial = √† fournir)
         |
Stagiaire ‚Üí Uploade chaque document ‚Üí statut passe √† ‚Äú√† valider‚Äù
         |
Admin ‚Üí V√©rifie/valide/refuse chaque document
         |
Si tous ‚Äúvalid√©s‚Äù ‚Üí Dossier passe √† ‚Äúcomplet/accept√©‚Äù
Sinon ‚Üí ‚Äúincomplet‚Äù

------------------------------------------------------------------

# Cr√©ation d‚Äôun Dossier d‚ÄôInscription avec Documents Automatiques

graph TD
    A[Admin ou Stagiaire<br/>initie une inscription] --> B[Choix de la formation]
    B --> C[Appel du service<br/>createWithRequiredDocuments]
    C --> D[Cr√©ation d'un nouveau Dossier]
    D --> E[R√©cup√©ration de la liste des<br/>documents obligatoires pour la formation]
    E --> F[Pour chaque document attendu,<br/>cr√©ation d'un Document dans le Dossier<br/>statut = '√Ä fournir']
    F --> G[Sauvegarde du Dossier<br/>avec tous ses Documents]
    G --> H[Retour √† l'utilisateur<br/>(le stagiaire voit son Dossier et les Documents √† fournir)]

--------------------------------------------------------------

# r√©sum√© visuel de la logique

graph LR
  Formation -- "1..n" --> ListeDocumentsObligatoires
  ListeDocumentsObligatoires -- "n..1" --> TypeDocument
  Stagiaire -- "1..n" --> Inscription
  Inscription -- "n..1" --> Formation
  Inscription -- "1..1" --> Dossier
  Dossier -- "1..n" --> Document
  Document -- "n..1" --> StatutDocument
  Dossier -- "n..1" --> StatutDossier
  Dossier -- "n..1" --> Stagiaire
  Dossier -- "n..1" --> Formation
  Dossier -- "n..1" --> Admin

----------------------------------------------------

- ou cr√©er cette m√©thode ? createWithRequiredDocuments -> dans DossierService ? √† la place de celle-ci ?

'@Transactional
    public Dossier create(Dossier dossier, AppUserDetails userDetails) {

        // D√©finit l'admin cr√©ateur
        dossier.setCreateur((Admin) userDetails.getUser());

        // D√©finit le statut par d√©faut (en attente de validation)
        if (dossier.getStatutDossier() == null) {
            StatutDossier statut = new StatutDossier();
            statut.setId(1);
            dossier.setStatutDossier(statut);
        }

        // Force la cr√©ation d'un nouveau dossier
        dossier.setId(null);

        // Ajoute la date de cr√©ation
        dossier.setDateCreation(LocalDateTime.now());

        return dossierDao.save(dossier);
    }
'
- Faut il que je cr√©er 2 m√©thodes disctinctes de cr√©ation de dossier dans Dossiercontroller ?
celle-ci √©tant celle qui permet √† l'admin de cr√©er le 1er dossier du stagiaire quand il cr√©er le profil du stagiaire :

'@PostMapping
    @IsAdmin
    @JsonView(AffichageDossier.Dossier.class)
    public ResponseEntity<Dossier> createDossier(@Valid @RequestBody Dossier dossier,
                                                 @AuthenticationPrincipal AppUserDetails userDetails) {

        // V√©rifie si l'ID de formation existe
        if (dossier.getFormation() == null || dossier.getFormation().getId() == null) {
            return new ResponseEntity<>(HttpStatus.BAD_REQUEST); // ou autre message d'erreur appropri√©
        }

        // R√©cup√®re la formation compl√®te √† partir de l'ID
        Formation formation = formationDao.findById(dossier.getFormation().getId())
                .orElseThrow(() -> new RuntimeException("Formation non trouv√©e avec l'id : " +
                        dossier.getFormation().getId()));

        dossier.setFormation(formation); // On associe la formation persist√©e

        // D√©l√®gue la cr√©ation au service
        Dossier created = dossierService.createWithRequiredDocuments(
                dossier.getStagiaire(),
                dossier.getFormation(),
                (Admin) userDetails.getUser()
        )
        return new ResponseEntity<>(created, HttpStatus.CREATED);
    }'

- il faudrait donc une m√©thode qui permette aussi au stagiaire de cr√©er un dossier, une fois son compte valid√©.

- montre moi comment et ou faire ceci : Pr√©cise bien c√¥t√© service pour ne retourner que les dossiers du stagiaire courant si tu veux s√©curiser.

- comment tester ceci : chaque dossier cr√©√© pour une formation diff√©rente doit g√©n√©rer la bonne liste de documents automatiquement !

-----------------------------------------------------------------------

- est ce que ce code permet au stagiaire de creer son dossier de fa√ßon s√©curis√©e et √† l'admin de cr√©er un dossier stagiaire quand c'est le premier qu'il faut cr√©er (avec le compte/ profil du stagiaire) ?
- explique moi ce qu'est 'caster'
- explique moi ce qu'est un payload et pourquoi j'en aurais besoin

--------------------------------------------------------------------------

1. Est-ce que ce code permet‚Ä¶ ?

A. √Ä l‚Äôadmin de cr√©er le premier dossier stagiaire ?

Oui !

L‚Äôadmin cr√©e un compte stagiaire ET son premier dossier via l‚Äôendpoint /dossiers (ou /dossiers/admin).

Le service cr√©e le dossier, g√©n√®re la bonne liste de documents (selon la formation choisie):
Tout est automatique.

L‚Äôadmin est bien enregistr√© comme ‚Äúcr√©ateur‚Äù du dossier.

B. Au stagiaire de cr√©er lui-m√™me un dossier pour une nouvelle formation?
Oui, si tu ajoutes un endpoint r√©serv√© aux stagiaires.

Tu ajoutes un endpoint /dossiers/self (ou similaire), s√©curis√© par @IsStagiaire.

Dans ce cas, tu passes le userDetails du stagiaire courant: il n‚Äôy aura pas d‚Äôadmin ‚Äúcr√©ateur‚Äù, et le stagiaire est bien li√© √† son dossier.

Le service reconna√Æt le cr√©ateur (stagiaire ou admin) selon le contexte.

Donc :

Oui, le code est s√©curis√© et adapt√©, √† condition de bien s√©parer les routes et la s√©curit√© c√¥t√© contr√¥leur.

Pense √† v√©rifier dans le service que le stagiaire ne cr√©e un dossier que pour lui-m√™me:
(exemple: comparer l‚ÄôID stagiaire du user connect√© √† l‚ÄôID stagiaire pass√© dans la requ√™te).

--------------------------------------------------------------------

=> Reste liste de documents √† g√©n√©rer

--------------------------------------------------------------------

2. Qu‚Äôest-ce que ‚Äúcaster‚Äù ?

‚ÄúCaste‚Äù (ou ‚Äúcaster‚Äù en anglais) = convertir un objet d‚Äôun type g√©n√©ral √† un type plus pr√©cis.

En Java, tu as souvent des objets de type g√©n√©rique (Object ou une super-classe comme User),
mais tu veux acc√©der aux m√©thodes ou attributs d‚Äôune sous-classe (Admin).

Exemple de ‚Äúcast‚Äù :

java
Copier
Modifier
User user = ...;
Admin admin = (Admin) user; // On "caste" user en admin
Pourquoi? Parce que toutes les m√©thodes/attributs de Admin ne sont pas visibles tant qu‚Äôon reste sur User.

Risques: Si l‚Äôobjet n‚Äôest pas vraiment du type cible, tu as une ClassCastException.

Bonne pratique: Toujours v√©rifier avec instanceof avant de caster !

----------------------------------------------------------------

Besoin du code pour l‚ÄôInscription ou pour cr√©er un stagiaire aussi ?
Ou tu veux le endpoint pour ajouter la liste des documents obligatoires √† une formation ?

----------------------

pertinence de la conservation du DTO si j'utilise Json et donc garder Mapper ou non ? (mapper utiles pour conversion entit√©/dto)

----------------------------------------------

3. Ce qui est bien et √† garder:

Utilisation d‚Äôun Mapper pour faire DTO <-> Entit√© (tr√®s propre pour l‚ÄôAPI, √©vite d‚Äôexposer les entit√©s brutes)

M√©thodes utiles et r√©utilisables (findAll, existsByEmail, etc.)

Logique d‚Äôinscription (inscrireStagiaire) bien factoris√©e.

----------------------------

- j'aimerais savoir si je peux me passer de DTO pour le stagiaire puisque je compte travailler avec du json. d'ailleurs j'aimerais que tu m'expliques comment √ßa fonctionne exactement avec le json.
- ensuite, si je n'ai pas de dto √ßa veut dire que le mapper n'est plus utile non plus non ?
- je veux que tu me donne le code ppur StagiaireService.java et StagiaireServiceImpl.java

---------------------------------

1. Peux-tu te passer de DTO pour Stagiaire ?

Oui, tu peux !
Si:

Tu es √† l‚Äôaise avec le fait que ton entit√© JPA (Stagiaire) est expos√©e telle quelle √† ton front (ou Postman).

Tu ma√Ætrises les √©ventuels probl√®mes de s√©curit√© ou de gestion des champs non voulus (tu peux cacher avec @JsonIgnore sur certains champs si besoin).

Tu simplifies ainsi la gestion: tu re√ßois et retournes des objets Stagiaire, sans conversion.

Spring Boot/Jackson va (d√©)s√©rialiser automatiquement le JSON de la requ√™te/r√©ponse en objets Stagiaire.

---------------------------------

dans StagiaireService :

ces m√©thodes ne sont pas utiles ?
    List<Stagiaire> findByStatutInscription(StatutInscription statut);
    List<Stagiaire> findInscritsEntre(LocalDate debut, LocalDate fin);
    Inscription inscrireStagiaire(Stagiaire stagiaire, Formation formation);

-----------------

R√©partition de la logique m√©tier

AuthController
 ‚îú‚îÄ /inscription         --> Cr√©ation de compte stagiaire (Appelle StagiaireService.save)
 ‚îú‚îÄ /validate-email      --> Validation du compte par token
 ‚îú‚îÄ /connexion           --> Login
 ‚îú‚îÄ /change-password     --> Changement mdp (1√®re co ou reset)

StagiaireController
 ‚îú‚îÄ /stagiaires          --> CRUD Stagiaire (list, get, update, delete)
 ‚îú‚îÄ /stagiaires/{id}     --> Acc√®s individuel au profil
 ‚îú‚îÄ /stagiaires/{id}/inscriptions  --> Voir les inscriptions/dossiers du stagiaire
...

------------------------

Le code d‚Äôun AuthController ‚Äúpropre‚Äù qui appelle le service

Un exemple de route d‚Äôinscription qui g√®re tout, envoie le mail, etc.

---------------------------

AuthController
 ‚îú‚îÄ /inscription
 ‚îú‚îÄ /connexion
 ‚îú‚îÄ /validate-email
 ‚îú‚îÄ /forgot-password
 ‚îú‚îÄ /reset-password      <-- ici !
 ‚îî‚îÄ /change-password

UserController
 ‚îú‚îÄ /users        (CRUD, gestion de profil, recherches)
 ‚îú‚îÄ /users/{id}
 ‚îî‚îÄ ...

------------------------

public boolean isEnabled() {
        return true;
    }

public void setEnabled(boolean b) {
    }

methode utilis√©e dans AuthController que l'ide demande de cr√©er dans User mais qui existe dans AppUserDetails :

@Override
    public boolean isEnabled() {
        return user.getJetonVerificationEmail() == null; // tu peux ajouter un champ dans User si besoin
    }

- Est ce que √ßa n'est pas UserDao et non UserService que je devrais injecter dans le AuthController ?

- Est ce que je peux garder cette ligne l√† 'stagiaire.setPremiereConnexion(true);' dans la m√©thode Inscription du AuthController ?

- est ce que je dois forcement cr√©er cette m√©thode 'public void sendActivationEmail(String email, String tokenValidationEmail) {}'dans EmailService ?

-----------------

dans mon authController il m'a √©t√© demand√© d'ajouter ces 2 m√©thodes dans UserService.java :

void requestPasswordReset(String email);

void resetPassword(String token, String newPassword);

et j'ai aussi cette erreur :

C:\Users\helen\OneDrive\Bureau\Metz Numeric School\MNS - CDA\Titre\ADMIN_MNS_Helene_Rizzon_local\backend\admin_mns\src\main\java\com\hrizzon2\demotest\service\UserServiceImpl.java:13:8
java: com.hrizzon2.demotest.user.service.User.UserServiceImpl is not abstract and does not override abstract method resetPassword(java.lang.String,java.lang.String) in com.hrizzon2.demotest.user.service.User.UserService

// Code corrig√©
-----------------------------------

# Flow logique des √©tapes :

ADMIN                BACKEND                    EMAIL                STAGIAIRE

  |                    |                          |                      |
1 |-- Cr√©e compte ---->|                          |                      |
  |                    |-- Save user -----------‚Üí |                      |
  |                    |-- G√©n√®re token          |                      |
  |                    |-- Envoie mail --------‚Üí |                      |
  |                    |                          |--- Mail re√ßu ------> |
  |                    |                          |                      |
2 |                    |<---- Validation email -- | <----- Clique lien --|
  |                    |-- Valide token           |                      |
  |                    |-- Active user            |                      |
  |                    |-- Demande modif mdp?     |                      |
  |                    |                          |                      |
3 |                    |<---- Changement mdp ---- | <--- Form front ---- |
  |                    |-- V√©rifie flag           |                      |
  |                    |-- Update password        |                      |
  |                    |-- Fin flag premi√®reConn. |                      |
  |                    |                          |                      |
4 |<------------------ Login / Connexion ------------------------------>|
  |                    |-- G√©n√®re JWT             |                      |
  |<------------------- Token envoy√© ------------>|                      |
  |                    |                          |                      |
5 |<- Reset password-->|<-- demande front ------- |                      |
  |                    |-- G√©n√®re resetToken      |                      |
  |                    |-- Envoie mail reset ---->|                      |
  |                    |                          |--- Mail re√ßu ------> |
  |                    |<-- Lien reset mdp ------ | <--- Clique lien --- |
  |                    |-- Update password        |                      |
  |                    |-- Reset token invalid√©   |                      |

--------------------------------------

# Diagramme de s√©quence UML :

@startuml
actor Admin
actor Stagiaire
participant "API Backend" as API
participant "Email (MailTrap...)" as Mail

== Cr√©ation de compte ==
Admin -> API : POST /auth/stagiaire (infos stagiaire)
API -> API : Enregistre le stagiaire (enabled=false, jeton, password encod√©)
API -> Mail : sendActivationEmail(email, token)
Mail -> Stagiaire : Re√ßoit le mail avec lien activation

== Activation de compte ==
Stagiaire -> API : POST /auth/validate-email (token)
API -> API : V√©rifie token, active user, reset jeton
API -> Stagiaire : Renvoie succ√®s (premiereConnexion=true si stagiaire)

== Changement mot de passe premi√®re connexion ==
Stagiaire -> API : POST /auth/change-password (email, mdp)
API -> API : V√©rifie flag, met √† jour password, premiereConnexion=false
API -> Stagiaire : Succ√®s

== Connexion ==
Stagiaire -> API : POST /auth/connexion (email, mdp)
API -> API : V√©rifie enabled/password
API -> API : G√©n√®re JWT
API -> Stagiaire : Retourne le token

== Reset password ==
Stagiaire -> API : POST /auth/forgot-password (email)
API -> API : G√©n√®re resetToken, enregistre
API -> Mail : sendResetPasswordEmail(email, resetToken)
Mail -> Stagiaire : Re√ßoit mail reset
Stagiaire -> API : POST /auth/reset-password (token, nouveau mdp)
API -> API : V√©rifie token, update password, reset token
API -> Stagiaire : Succ√®s
@enduml

----------------------------

# Sch√©ma dessin√© :

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    Admin     ‚îÇ‚îÄ‚îÄ‚ñ∫‚îÄ‚îÄ‚ñ∂‚îÇ  POST /auth/stagiaire ‚îÇ‚îÄ‚îÄ‚ñ∫‚îÄ‚îÄ‚ñ∂‚îÇ    Backend    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ (save user,   ‚îÇ
                                                    ‚îÇ gen token,    ‚îÇ
                                                    ‚îÇ send mail)    ‚îÇ
                                                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                          ‚îÇ
                                                          ‚ñº
                                          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                          ‚îÇ    Email      ‚îÇ
                                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                ‚îÇ
                                                ‚ñº
                                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                       ‚îÇ  Stagiaire    ‚îÇ
                                       ‚îÇ  (re√ßoit mail)‚îÇ
                                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                ‚îÇ
                         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                         ‚ñº                                            ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ  Clique lien validation email  ‚îÇ     ‚îÇ   Oubli mot de passe (front)         ‚îÇ
        ‚îÇ  POST /auth/validate-email     ‚îÇ     ‚îÇ   POST /auth/forgot-password         ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ                                        ‚îÇ
                      ‚ñº                                        ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ Validation token / Activate‚îÇ              ‚îÇ  Gen resetToken / Send mail‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ                                          ‚îÇ
                      ‚ñº                                          ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ POST /auth/change-password ‚îÇ              ‚îÇ  Clique lien /auth/reset  ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ                                          ‚îÇ
                      ‚ñº                                          ‚ñº
                Mot de passe chang√©                  Mot de passe r√©initialis√©
                      ‚îÇ                                          ‚îÇ
                      ‚ñº                                          ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ        Connexion           ‚îÇ              ‚îÇ        Connexion          ‚îÇ
        ‚îÇ POST /auth/connexion       ‚îÇ              ‚îÇ POST /auth/connexion      ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

----------------------

C:\Users\helen\OneDrive\Bureau\Metz Numeric School\MNS - CDA\Titre\ADMIN_MNS_Helene_Rizzon_local\backend\admin_mns\src\main\java\com\hrizzon2\demotest\controller\StagiaireController.java:104:63
java: incompatible types: com.hrizzon2.demotest.user.model.Stagiaire cannot be converted to com.hrizzon2.demotest.dto.stagiaire.StagiaireDTO

=> enlever tous les DTO => FAIT

-----------------------

Suite √† suppression DTO Stagiaire -> penser √† v√©rifier front :

6. V√©rifie le front !
Si ton front envoie un objet au format DTO (champs diff√©rents de ton entity !), il faudra soit:

Adapter le front pour envoyer exactement la structure de l‚Äôentit√© Stagiaire

Ou alors tu es oblig√©e de garder au moins un DTO c√¥t√© backend‚Ä¶ (Mais je comprends que tu veux simplifier, donc adapte le front !)

---------

verification json view - annotations entit√© Stagiaire

-----------------------

Fais bien h√©riter tes vues si tu veux √©viter les r√©p√©titions.

Si certaines donn√©es doivent rester strictement priv√©es (tokens, mot de passe, etc.), ne les expose jamais en JsonView par d√©faut et pr√©f√®re une vue vraiment d√©di√©e (ou @JsonIgnore pour les champs qui ne doivent jamais √™tre expos√©s).

Sur le front, ajuste tes mod√®les Typescript √† la structure r√©ellement re√ßue.


           +----------------+           +-----------------------+
           |    Controller  |----[JsonView]---->|    Stagiaire Entity    |
           +----------------+           +-----------------------+
                        |                   |     @JsonView sur chaque champ !
             ResponseEntity<List<Stagiaire>> |     Contr√¥le granulaire.
                        |
                  [s√©rialisation]
                        |
                 => r√©ponse JSON au front (Angular)

---------------------------------

j'ai un TypeDocument mais c'est un enum, est ce que je le laisse en enum ? et pour reconnaitre un document obligatoire est ce qu'il est conseill√© de donner un code de niveau pour les formations afin de simplifier la lecture ?
en parall√®le propose moi un contenu JSON pour les formations de niveau A, B et C en me montrant comment faire mes requetes dans JetClient. j'ai d√©j√† un dossier Formation dans JetClient avec des m√©thodes Get, Get all, create, delete et update.
Montre moi comment associer les documents obligatoires demand√©s avec les documents envoy√©s par le stagiaire dans l'application, cote back pour le moment, nous nous occuperons du front apres.

-----------------------------------

La logique m√©tier pour croiser les documents attendus et les documents transmis par un stagiaire se met dans un service.
Tu as deux options:

Dans DocumentStagiaireService (le plus coh√©rent)
‚Üí Car il va manipuler les documents r√©els transmis, et peut avoir besoin d‚Äôacc√©der √† la liste des attendus via un autre service ou le DAO.

Tu peux aussi cr√©er un service m√©tier ‚ÄúDossierService‚Äù si tu veux isoler la logique de v√©rification de compl√©tude, mais pour l‚Äôinstant, le plus simple est dans DocumentStagiaireService.

=> A voir plus tard avec logique de Dossier pour g√©rer compl√©tion du dossier

-----------------------------

En effet, je souhaite g√©rer √† terme la compl√©tude du dossier avec la transmission de tous les documents demand√©s.
pour rappel, un document envoy√© par le stagiaire est soumis √† v√©rification et validation de l'Admin avant de compl√©ter la liste des documents obligatoires. √ßa n'est qu'un fois la totalit√© des documents demand√©s, transmis, v√©rifi√©s et valid√©s que le dossier peut √™tre d√©termin√© comme complet. Est ce que √ßa change quelque chose dans la gestion de la logique m√©tier, est ce que dans ce cas l√† √ßa n√©cessite la cr√©ation d'un DTO ?
pour l'affichage de la liste de documents obligatoires et les documents transmis par le stagiaire, un DTO est il n√©cessaire pour faire le lien entre les deux et g√©rer l'affichage dans le front ?

ensuite pour ce qui est de cette requ√™te 'Lister tous les documents d‚Äôun stagiaire pour une formation', est ce que c'est un  mettre dans un dossier stagiaire ou dans un dossier formation dans jet client ?
Et pour supprimer un document, c'est le stagiaire qui peut supprimer un document envoy√© ?

pour finir, je veux bien voir la logique de comparaison(attendus vs transmis)

=======================

REPONSE :

 Compl√©tude du dossier et validation par l‚Äôadmin ‚Äî Faut-il un DTO?
Oui!
D√®s que tu veux pr√©senter la situation de compl√©tude d‚Äôun dossier (pour l‚Äôadmin, le stagiaire, le front, etc.),
il te FAUT un DTO sp√©cifique.
Pourquoi? Parce que tu dois assembler:

- Les documents attendus,
- Les documents transmis,
- Leur statut de validation (Valid√©, Rejet√©, En attente‚Ä¶),
- Et calculer si la compl√©tude est atteinte.

Ton DTO doit donc comporter pour chaque document attendu:

- Le type de document attendu (TypeDocument)
- Si le document a √©t√© transmis
- Si oui: statut (Valid√©, En attente, etc.)
- URL ou nom du fichier transmis
- Un bool√©en ‚Äúest-ce que tout est complet?‚Äù (pour le dossier en entier)

--------------------

Liste des requ√™tes documents

| Dossier        | Requ√™te (Verbe + URL)                                                              | But                                          |
| -------------- | ---------------------------------------------------------------------------------- | -------------------------------------------- |
| Stagiaire      | GET `/stagiaires/{stagiaireId}/formations/{formationId}/statut-documents`          | Lister la progression sur les documents      |
| Stagiaire      | GET `/stagiaires/{stagiaireId}/formations/{formationId}/documents`                 | Lister documents transmis                    |
| Stagiaire      | POST `/stagiaires/{stagiaireId}/formations/{formationId}/documents`                | Ajouter un document transmis                 |
| Stagiaire      | DELETE `/stagiaires/{stagiaireId}/formations/{formationId}/documents/{documentId}` | Supprimer un document transmis               |
| Formation      | GET `/formations/{formationId}/documents-obligatoires`                             | Lister documents obligatoires pour formation |
| Formation      | POST `/formations/{formationId}/documents-obligatoires`                            | Ajouter un document obligatoire              |
| StatutDocument | GET `/statut-document`                                                             | Lister tous les statuts                      |
| StatutDocument | POST `/statut-document`                                                            | Cr√©er un statut                              |
| Dossier        | GET `/dossier/{id}`                                                                | R√©cup√©rer un dossier                         |
| Dossier        | GET `/dossier/stagiaire/{stagiaireId}`                                             | Tous les dossiers d‚Äôun stagiaire             |
| Dossier        | GET `/dossier/formation/{formationId}`                                             | Tous les dossiers d‚Äôune formation            |

---------------------
Sch√©ma synthtique -> Qui appelle Quoi ?

+-----------------------------------------+
|                Frontend                 |
|  (ex : JetClient, appli Angular)        |
+-----------------------------------------+
                 |
                 v
+----------------+--------------------------------------+
|            API (Spring Boot)                          |
+-------------------------------------------------------+
| FormationController                                   |
|    - CRUD formations                                  |
|    - GET /formations/{id}/documents-obligatoires      |
|                                                       |
| ListeDocumentsObligatoiresController                  |
|    - Associe documents obligatoires √† une formation   |
|                                                       |
| DocumentStagiaireController                           |
|    - POST /stagiaires/{id}/documents                  |
|    - GET /stagiaires/{id}/documents                   |
|    - GET /stagiaires/{stagiaireId}/formations/        |
|         {formationId}/statut-documents                |
|      (croise attendus / transmis + statut)            |
|                                                       |
| DossierController (si tu g√®res la compl√©tude globale) |
|    - GET /dossier/{id}                                |
|                                                       |
| StatutDocumentController                              |
|    - Liste/ajout des statuts de doc                   |
+-------------------------------------------------------+

--------------------------

Sch√©ma du flow envoi/chargement d'un doc

[Front : Formulaire d'upload]
         ‚îÇ
         ‚ñº
[Controller Spring Boot : re√ßoit fichier, valide, check droits]
         ‚îÇ
         ‚ñº
[FichierService : nettoie nom, stocke fichier, enregistre en base]
         ‚îÇ
         ‚ñº
[Disque dur (stockage)  +  Base de donn√©es (meta : chemin, statut, id...)]

------------------

3Ô∏è‚É£ R√©sum√© du parcours (‚Äúgymnastique‚Äù) lors d‚Äôun upload


- Front: L‚Äôutilisateur envoie un fichier via le formulaire.
-
- DocumentController re√ßoit le fichier, valide l‚Äôacc√®s, appelle le DocumentService.
-
- DocumentService:
-
- Nettoie le nom du fichier.
-
- Appelle FichierService pour √©crire le fichier sur disque.
-
- Cr√©e et sauvegarde un objet Document (meta : id stagiaire, nom, type, statut EN_ATTENTE‚Ä¶).
-
- FichierService √©crit le fichier sur le disque, dans le bon dossier.
-
- DocumentDao sauvegarde les infos du fichier en base.

------------------

POST /stagiaires/{id}/documents
      ‚îÇ
      ‚ñº
[DocumentController]
      ‚îÇ
      ‚ñº
[DocumentService.uploadDocument()]
      ‚îÇ
      ‚îú‚îÄ‚îÄ> [FichierService.uploadToLocalFileSystem()]
      ‚îÇ
      ‚îî‚îÄ‚îÄ> [DocumentDao.save(document)]

-----------------

  etapes √† poursuivre :

  continuer code et verif DocumentService.java + voir le reste

-------------------------

FLOW DE CREATION DOCUMENT

- Le controller re√ßoit le fichier, le type, et l‚Äôid du dossier ou du stagiaire.
- Le service stocke le fichier sur le disque.
- Le service r√©cup√®re le statut "EN_ATTENTE" depuis la base et l‚Äôassocie √† l‚Äôentit√© Document.
- Le service associe le bon dossier au Document.
- Le service sauvegarde le Document.

-------------------------

->> DocumentService.java -> on n'impl√©mente pas FichierService ?

StatutDocument est une entit√©, PAS un enum, tu dois la r√©cup√©rer en base. -> qu'est ce que √ßa veut dire ?

TypeDocument est un enum, tu peux utiliser .valueOf(...). -> o√π ?

Les setters g√©n√©r√©s par Lombok (@Setter) doivent correspondre aux noms de champs de ton entit√©. -> de quoi tu parles ?

je n'ai pas compris √ßa : Cr√©e le StatutDocumentDao (si pas d√©j√† fait)

                         Ajoute la table et les lignes n√©cessaires dans la base (EN_ATTENTE, VALIDE, REFUSE).

et explique moi √ßa : Mets √† jour le service pour chercher le statut "EN_ATTENTE" avant de l‚Äôaffecter √† un document.

                     Si besoin, cr√©e ou adapte le DossierDao pour r√©cup√©rer le dossier associ√©.

---------------

je ne vois toujours pas o√π ceci se passe :

'Dans le code, l√† o√π tu re√ßois le type du document en String (par exemple, "JUSTIFICATIF_DOMICILE").
Tu dois faire:
document.setType(TypeDocument.valueOf(typeDocument));'

√ßa se passe dans quel fichier ? :
Mais il faut que tu utilises le bon nom de champ dans ton code.

Par exemple, si dans Document tu as private String nomFichier; tu appelleras document.setNomFichier(...).

Si tu √©cris document.setCheminFichier(...) mais que le champ s‚Äôappelle nomFichier, √ßa plantera.

---------------------------

[Front]
  ‚îÇ
  ‚ñº
[DocumentController]
  ‚îÇ
  ‚ñº
[DocumentService] ---(utilise)---> [FichierService] (stocke le fichier)
  ‚îÇ
  ‚îú‚îÄ> [StatutDocumentDao] (statut "EN_ATTENTE" r√©cup√©r√© en base)
  ‚îú‚îÄ> [DossierDao] (dossier du stagiaire)
  ‚îî‚îÄ> [DocumentDao] (sauvegarde Document)

 Bonus: Checklist ‚ÄúPr√™t √† d√©ployer‚Äù

 J‚Äôai un StatutDocumentDao

 Ma table statut_document a bien les lignes EN_ATTENTE, VALIDE, REFUSE

 Mon DocumentService fait bien le lien avec le statut et le dossier existants (jamais en ‚Äúdur‚Äù)

 Mon FichierService ne g√®re QUE le stockage physique

 Le front envoie le bon typeDocument (conforme √† l‚Äôenum)

 J‚Äôai test√© l‚Äôupload et la sauvegarde du Document (v√©rifi√© en base et sur disque)

-------------------

[Stagiaire ‚Üí Frontend]
     ‚Üì
POST /stagiaires/{stagiaireId}/documents
     ‚Üì
[DocumentStagiaireController]
     ‚Üì
[DocumentStagiaireService.upload(...)]
     ‚Üì
[FichierService.uploadToLocalFileSystem()]
     ‚Üì
[DocumentStagiaireDao.save()]
     ‚Üì
[Base de donn√©es, Dossier √† jour, Fichier stock√©]


-------------


                                  ================
                                  =  05/06/2025  =
                                  ================

QUESTIONS :

* Dans la classe User (table users) :

    - est ce que je doiis afficher une colonne jetonVerificationEmail ?
    - comment doit apparaitre la colonne reset_password_token dans la table ? quelle value ?

* protected StatutDossier statutDossier :

    - je dois annoter comme une relation mais comment ? est ce que je dois rajouter une annotation √† celles d√©j√† existantes ou changer l'ordre ?
    @NotNull
        @ManyToOne(fetch = FetchType.LAZY)
        @JoinColumn(nullable = false)
        @JsonView(AffichageDossier.Dossier.class)
        protected StatutDossier statutDossier;

* // private StatutDocument statutDocument;

    - est ce que tu veux dire qu'il faut que je d√©commente ou je j'enl√®ve ce code de l'entit√© Dossier ?

* StatutDossier et StatutDocument :

    - Ce sont pour le moment des entit√©s,
    Est ce qu'il vaut mieux les passer en enum pour plus de clart√© ?

* Document ou PieceJointeStagiaire :

    - 1. Choisir une seule entit√© pour repr√©senter l‚Äôenvoi de fichier :
    soit fusionner Document et PieceJointeStagiaire en une seule classe (ex. PieceJointe),
    soit justifier pourquoi elles coexistent (ex. Document = pr√©vu pour notifications,
    PieceJointeStagiaire = pr√©vu pour dossiers).
    Si fusion, mettre √† jour la relation ‚ÄúDossier‚Äì>Document‚Äù et supprimer PieceJointeStagiaire ou rediriger tous les services vers la nouvelle classe.
    2. Supprimez (ou archivez) la classe dupliqu√©e pour √©viter la confusion.
    Veillez √† migrer les annotations, tests et contr√¥leurs li√©s √† l‚Äôentit√© que vous conservez. |

    - dans la mesure o√π Document concerne les documents attendus (ListeDocumentsObligatoires)
    et permet de g√©rer les doucments envoy√©s pour justifier d'un retard ou une absence du stagiaire,
    et que PieceJointeStagiaire g√®re les documents envoy√©s par un stagiaire pour compl√©ter le dossier,
    est ce qu'il n'est pas pertinent de conserver les deux entit√©s ?

* Doublon @ManyToOne(optional=false) private Stagiaire stagiaire; dans PieceJointeStagiaire.java, Dossier et Inscription :

    - Un Stagiaire envoie un document (entit√© Document ou PieceJointeStagiaire) et a un ou plusieurs Dossier,
    le Dossier, lorsqu'il passe √† l'√©tat complet, valide l'Inscription

* Motif :

    - Pour que les motifs s'affichent dans le front (liste d√©roulante)
    est ce que les afficher dans data-donnees-test suffit
    ou il vaut mieux les avoir en dur dans le code, au travers d'un enum par exemple ?

* Dossier :

    - La ligne INSERT INTO dossier (‚Ä¶) existe d√©j√† dans data-donnees-test.sql

* Inscription :

    - J'envisage de supprimer l'entit√© Inscription pour conserver l'enum StatutInscription
    et je pense modifier StatutInscription pour conserver seulement un boolean pour dire si StatutInscription est valide ou non.
    ou faire une liste de 3 possibilit√©s : valide/invalide/en cours

================

A FAIRE au 05-06 :

* DossierService -> m√©thode de recalcul du StatutDossier selon mise √† jour document

* Document et/ou PieceJointeStagiaire :
    Voir si n√©cessit√© des deux entit√©s
    -> | Document.java vs PieceJointeStagiaire.java |
    - Il existe deux entit√©s qui couvrent sensiblement la m√™me fonction (gestion d‚Äôun fichier) :
    Document et PieceJointeStagiaire.
    Cette redondance risque d‚Äôintroduire des comportements incoh√©rents
    (l‚Äôune se trouve dans model.Document, l‚Äôautre dans model.PieceJointeStagiaire).

* Entit√©s / Model :
    Faire le tour des entit√©s pour s'assurer qu'elles sont correctement mapp√©es pour apparaitre dans les donn√©es tests

* Inscription :
    Est-ce qu'il est vraiment pertinent de conserver toutes les donn√©es dans cette entit√© ? Dossier peut g√©rer √ßa
    Et Inscription sera juste un statut_inscription (deja existant) pour dire si valide ou non.

---------------

Refacto √† op√©rer 06/06

=> Fusion PieceJointeStagiaire + Document
-> Conserver 2 controllers pour :
    * gestion Doc - Evenement -> JustificatifController
    * gestion compl√©tude Dossier -> CompletudeDossierController

Voir gestion des services

----------------

11/06

Quelles m√©thodes ?
-> MotifDao
-> EvenementDao
-> FormationDao
-> VilleDao

------------------------

Diagramme d'architecture :

 +---------------------+        +---------------------+        +---------------------+
 |  Controller Layer    | <----> |   Service Layer     | <----> |    DAO Layer        |
 +---------------------+        +---------------------+        +---------------------+
 |                     |        |                     |        |                     |
 | - StagiaireController|        | - StagiaireService  |        | - StagiaireDao      |
 | - DocumentController |        | - DocumentService   |        | - DocumentDao       |
 | - ValidationDocumentController| - ValidationDocumentService | - StatutDocumentDao  |
 | - DossierController  |        | - DossierService    |        | - DossierDao        |
 | - EvenementController|        | - EvenementService  |        | - EvenementDao      |
 | - InscriptionController|      | - InscriptionService|        | - InscriptionDao    |
 | - AdminController    |        | - AdminService      |        | - AdminDao (si besoin)|
 | - NotificationController|     | - NotificationService|       | - NotificationDao (optionnel)|
 +---------------------+        +---------------------+        +---------------------+

 => Motifs != selon type d'√©v√®nement

---------------------

Diagramme de s√©quences - "Validation document" et "Seuils Absences/Retards"

Utilisateur(Administrateur)        NotificationTriggerService          NotificationService         AdminService        DossierService

        |                                  |                                  |                       |                    |
        |--- Valide/Rejette Document ----->|                                  |                       |                    |
        |                                  |--- onDocumentValidation() ------>|                       |                    |
        |                                  |                                  |--- Cr√©e notif stagiaire ---> Save en BD            |
        |                                  |                                  |                       |                    |

        |                                  |                                  |                       |                    |
        |--- D√©clare Absence/Retard ------>|                                  |                       |                    |
        |                                  |--- checkSeuilsAbsenceRetard() --->|                       |                    |
        |                                  |                                  |                       |                    |
        |                                  |                                  |<-- dossierService.countAbsences()                  |
        |                                  |                                  |<-- dossierService.countRetards()                    |
        |                                  |                                  |                       |                    |
        |                                  |                                  |-- notif stagiaire si seuil atteint ou proche ----> Save en BD
        |                                  |                                  |                       |                    |
        |                                  |                                  |-- demande admins concern√©s via adminService ----> |
        |                                  |                                  |                       |                    |
        |                                  |                                  |-- notif admins seuil atteint/proche ------------> Save en BD

-----------------------------

ok donc on reprend √† 0.
je conserve DocumentController pour la gestion des documents et je vire PieceJointeStagiaireController.
je garde DossierDocumentService pour la gestion des documents qui compl√®tent le dossier
et EvenementDocumentService pour la gestion documentaire pour justifier les √©v√®nements ?
ValidationDocumentController pour g√©rer la validation d'un document envoy√© par un stagiaire, cot√© admin.
et ListeDocumentsObligatoires pour comparer les documents envoy√©s via DocumentController .
c'est √ßa ?

---------------------------------
---------------------------------

OUTILS API

üöÄ Pour votre projet

STACK COMPLETE :

- Swagger pour mod√©liser l‚ÄôAPI et g√©n√©rer la doc/SDK.

- JetClient (ou Postman si hors JetBrains) pour tester et valider, int√©grable dans un pipeline CI.

- Lunalytics pour monitorer en production l‚Äôuptime et pr√©venir automatiquement en cas de probl√®me.

-------------

=> ‚úÖ Conclusion :

   Utilisez Lunalytics pour la surveillance et l‚Äôalerte de production.

   Utilisez OpenAPI/Swagger pour d√©finir et documenter l‚ÄôAPI.

   Utilisez un client comme JetClient ou Postman pour tester votre API de fa√ßon robuste.

   Ces outils sont compl√©mentaires et ensemble, ils couvrent tout le cycle de vie de vos API : conception, tests, documentation et monitoring.

-------------

OUTILS :

- LUNALYTICS (open-source) :
Lunalytics fonctionne avec n‚Äôimporte quelle techno tant que tu exposes un service r√©seau (HTTP, HTTPS, TCP).
Tu d√©clares simplement l‚ÄôURL ou l‚ÄôIP/port √† surveiller, et il s‚Äôoccupe du reste.


D√©v ‚Üí Recette/Test ‚Üí Pr√©production (staging) ‚Üí Production
           ‚Üë                ‚Üë                   ‚Üë
         Postman         Postman            Lunalytics
         Swagger         Swagger            Lunalytics

-------
Swagger ne remplace pas les tests unitaires c√¥t√© code:

- Les tests unitaires v√©rifient la logique de tes fonctions, classes, contr√¥leurs, etc. dans ton code backend (ex: m√©thode Java, m√©thode de service Spring‚Ä¶).
- Les tests Swagger testent la conformit√© de ton API et peuvent t‚Äôaider √† valider que le contrat (les routes, sch√©mas de donn√©es) est bien respect√©.

√Ä tester avec Swagger ou Postman:
- Les requ√™tes API (endpoints, params, retours)
- Mais les vrais tests unitaires se font dans le code, avec JUnit (Java), Pytest (Python), Jest (JS/TS), etc.

------------------------
PIPELINE CI/CD :

Code ‚Üí CI/CD ‚Üí Build Docker image ‚Üí Test (via Docker) ‚Üí Docker Hub ‚Üí D√©ploiement

---------------------------
Exemple ultra simple de plan de tests pour une appli web :


| ID   | Fonctionnalit√©       | Pr√©-requis         | √âtapes √† suivre                                                 | R√©sultat attendu               | Statut |
| ---- | -------------------- | ------------------ | --------------------------------------------------------------- | ------------------------------ | ------ |
| T-01 | Connexion            | Utilisateur existe | 1. Aller page login<br>2. Saisir email/mdp<br>3. Valider        | Acc√®s au dashboard             | OK/NOK |
| T-02 | Ajout article panier | √ätre connect√©      | 1. Ouvrir page produit<br>2. Ajouter au panier                  | Article affich√© dans le panier | OK/NOK |
| T-03 | D√©connexion          | √ätre connect√©      | 1. Cliquer sur ‚ÄúD√©connexion‚Äù                                    | Retour √† la page login         | OK/NOK |
| T-04 | Cr√©ation de compte   | -                  | 1. Aller sur inscription<br>2. Remplir formulaire<br>3. Valider | Compte cr√©√©, email re√ßu        | OK/NOK |

----------------- Pour faire plan de tests :

- Lister toutes les fonctionnalit√©s importantes √† tester (connexion, CRUD, navigation‚Ä¶)
- D√©tailler pour chacune :
    * Dans quelles conditions commencer le test?
    * Quelles actions faire (clics, saisies, etc.)?
    * Quel r√©sultat on attend?
    * (Facultatif) Qui r√©alise le test, quand, sur quel environnement?
- On ex√©cute chaque sc√©nario et on note le statut


Sch√©ma global de l‚Äôorganisation moderne:

[Dev1, Dev2, ...]
     |
   (Code sur GitHub/GitLab)
     |
[Pipeline CI/CD automatique]
     |      |      |
 [Build] [Test] [Analyse]
     |
[Images stock√©es sur Docker Hub]
     |
[D√©ploiement sur des serveurs, via Docker Compose]

------------------------

R√©sum√© express :

- Serveur d‚Äôint√©gration: machine qui ex√©cute les tests automatiquement
- Partage du code: via Git (GitHub, GitLab‚Ä¶)
- D√©ploiement/test multi-services: Docker/Docker Compose
- Stockage d‚Äôimages: Docker Hub
- Pipeline CI/CD: sc√©nario automatis√© de build/test/deploy √† chaque changement de code
- Plan de tests: tableau avec sc√©narios, √©tapes, r√©sultats attendus

=> Cf template plan de test dans Obsidian

----------------------------------

GESTION STOCKAGE DOCUMENTS

- /dao/
    - DocumentDao (JPA, SQL)
    - DocumentMongoRepository (MongoDB, extends MongoRepository)
- /models/
    - Document (entit√© SQL)
    - DocumentMongo (entit√© MongoDB)
    - AuditAction (classe embarqu√©e MongoDB)
- /services/
    - DocumentService (g√®re le SQL, la compl√©tude, etc.)
    - DocumentStorageService (g√®re GridFS si tu veux tester)

-----------------------

LOGIQUE DE PROGRESSION - UPLAOD DOCUMENT :

// Pseudo-code c√¥t√© service
1. R√©cup√©rer ListeDocumentsObligatoires pour la formation
2. R√©cup√©rer Documents d√©j√† envoy√©s par le stagiaire
3. Compter documents avec statut "VALIDE"
4. Progression = documentsValides / documentsRequis * 100

-------------------------

Architecture feature Document :


üìÅ document/controller/
  ‚îî‚îÄ‚îÄ DocumentController.java ‚Üê Un seul contr√¥leur pour tout !

üìÅ document/service/
  ‚îî‚îÄ‚îÄ DossierDocumentService.java ‚Üê Toute la logique m√©tier

üìÅ document/dto/
  ‚îú‚îÄ‚îÄ DocumentSummaryDto.java
  ‚îú‚îÄ‚îÄ DocumentStatutUpdateDto.java
  ‚îî‚îÄ‚îÄ DocumentAttenteDto.java

  DocumentController      ‚Üí Gestion principale (MySQL + logique m√©tier)
  DocumentUploadController ‚Üí Syst√®me d'audit MongoDB (optionnel)

  üìÅ document/controller/
    ‚îú‚îÄ‚îÄ DocumentController.java        ‚Üê Principal (MySQL)
    ‚îî‚îÄ‚îÄ DocumentUploadController.java  ‚Üê Audit (MongoDB)